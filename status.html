<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>觀景山工程部車輛預約系統狀態</title>
    <style>
        body {
            font-family: 'LXGW WenKai Mono TC', monospace;
        }

        h1 {
            font-size: 50px;
            font-weight: bold;
            text-decoration: underline;
        }

        table {
            font-size: 40px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>觀景山工程部車輛預約系統狀態</h1>
    <table id="data-table" border="1">
        <thead>
            <tr>
                <th>序號</th>
                <th>車牌</th>
                <th>部門/工號</th>
                <th>日期</th>
                <th>時段</th>
                <th>備註</th>
            </tr>
        </thead>
        <tbody>
            <!-- 資料將在此處動態添加 -->
        </tbody>
    </table>

    <script>
        const spreadsheetId = '1jWLAnhv5kB-zNFTneuoS4wHkgBShuNmukxml0LoGXjk';
        const sheetName = 'status';
        const apiKey = 'AIzaSyCbaDzFaJV56_GkqP1o9V4iB523k-5tpXE'; // 請替換為你的 Google Sheets API 金鑰
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}!A:G?key=${apiKey}`;

        // 定義時段排序順序
        const timePeriodOrder = [
            '09:00 - 18:00',
            '07:00 - 13:00',
            '12:00 - 14:00',
            '13:00 - 18:00',
            '18:00 - 23:00',
            '23:00 - 07:00',
            '00:00 - 23:59'
        ];

        async function fetchData() {
            try {
                const response = await fetch(url);
                const data = await response.json();
                const values = data.values.slice(1); // 排除標題行

                const currentDate = new Date();
                const validData = values.filter(row => {
                    const status = row[7]; // H 欄
                    const date = new Date(row[4]); // E 欄
                    return status!== '0' && date >= currentDate;
                });

                // 格式化日期
                const formattedData = validData.map(row => {
                    const date = new Date(row[4]);
                    const year = date.getFullYear();
                    const month = date.getMonth() + 1;
                    const day = date.getDate();
                    row[4] = `${year}年${month}月${day}日`;
                    return row;
                });

                // 排序資料
                formattedData.sort((a, b) => {
                    const dateA = new Date(a[4].replace('年', '-').replace('月', '-').replace('日', ''));
                    const dateB = new Date(b[4].replace('年', '-').replace('月', '-').replace('日', ''));
                    if (dateA!== dateB) {
                        return dateA - dateB;
                    }
                    const timePeriodA = a[5];
                    const timePeriodB = b[5];
                    return timePeriodOrder.indexOf(timePeriodA) - timePeriodOrder.indexOf(timePeriodB);
                });

                const tableBody = document.querySelector('#data-table tbody');
                const maxRows = 18;
                for (let i = 0; i < Math.min(maxRows, formattedData.length); i++) {
                    const row = formattedData[i];
                    const tr = document.createElement('tr');
                    const columnsToDisplay = [0, 1, 3, 4, 5, 6]; // A, B, D, E, F, G 欄
                    columnsToDisplay.forEach(index => {
                        const td = document.createElement('td');
                        td.textContent = row[index] || '';
                        tr.appendChild(td);
                    });
                    tableBody.appendChild(tr);
                }
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        fetchData();
    </script>
</body>

</html>